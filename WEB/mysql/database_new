CREATE TABLE USERS(
     username VARCHAR(25) UNIQUE NOT NULL,
	 password VARCHAR(25) NOT NULL,
	 profile ENUM('civilian','administrator','volunteer') NOT NULL,
	 PRIMARY KEY(username)
);


CREATE TABLE CIVILIAN (
    civilian_user VARCHAR(25),
    full_name VARCHAR(25) NOT NULL,
    phone CHAR(10) NOT NULL,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    PRIMARY KEY(civilian_user),
	 CONSTRAINT CIVILIANUSER FOREIGN KEY(civilian_user) REFERENCES USERS(username)
	 ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE CATEGORIES (
    category_id INT,
    category_name VARCHAR(255),
    PRIMARY KEY(category_id)
) ;


CREATE TABLE PRODUCTS (
    product_id INT NOT NULL,
    category_id INT NOT NULL,
    item VARCHAR(25) NOT NULL,
    description LONGTEXT NOT NULL,
    available INT NOT NULL,
    PRIMARY KEY(product_id),
    FOREIGN KEY (category_id) REFERENCES CATEGORIES(category_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) AUTO_INCREMENT=1000;


CREATE TABLE PRODUCT_DETAILS (
    product_id INT NOT NULL,
    detail_name VARCHAR(255),
    detail_value VARCHAR(255),
    FOREIGN KEY (product_id) REFERENCES PRODUCTS(product_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE INQUIRY (
    inquiry_id INT AUTO_INCREMENT,
    inquiry_user VARCHAR(25) NOT NULL,
    inquiry_product INT NOT NULL,
    inquiry_quantity INT NOT NULL,
    PRIMARY KEY(inquiry_id, inquiry_user),
	 CONSTRAINT INQUIRYUSER FOREIGN KEY(inquiry_user) REFERENCES CIVILIAN(civilian_user)
	 ON DELETE CASCADE ON UPDATE CASCADE,
	 CONSTRAINT PRODUCT_INQUIRY FOREIGN KEY(inquiry_product) REFERENCES PRODUCTS(product_id)
	 ON DELETE CASCADE ON UPDATE CASCADE
) AUTO_INCREMENT=1;


CREATE TABLE INQUIRY_DETAILS (
    details_id INT,
    inquiry_status ENUM('pending', 'approved', 'finished', 'cancelled') NOT NULL,
    inquiry_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    approved_vehicle_id VARCHAR(25),
    approved_timestamp DATETIME,
    CONSTRAINT INQUIRYDETAILS FOREIGN KEY(details_id) REFERENCES INQUIRY(inquiry_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ANNOUNCEMENTS (
    announce_id INT NOT NULL AUTO_INCREMENT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY(announce_id)
) AUTO_INCREMENT=3000;

CREATE TABLE ANNOUNCEMENT_ITEMS (
    announce_id INT NOT NULL,
    announce_product INT NOT NULL,
    quantity INT NOT NULL,
    FOREIGN KEY ANNOUNCE(announce_id) REFERENCES ANNOUNCEMENTS(announce_id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ANNOUNCE_OFFER(announce_product) REFERENCES products(product_id) 
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE OFFERS (
    offer_id INT AUTO_INCREMENT,
    offer_user VARCHAR(25) NOT NULL,
    offer_product INT NOT NULL,
    offer_quantity INT NOT NULL,
    announce_id INT,
    PRIMARY KEY(offer_id, offer_user),
	CONSTRAINT OFFERUSER FOREIGN KEY(offer_user) REFERENCES CIVILIAN(civilian_user)
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT PRODUCT_OFFER FOREIGN KEY(offer_product) REFERENCES PRODUCTS(product_id)
    ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT ANNOUNCEOFFER FOREIGN KEY(announce_id) REFERENCES ANNOUNCEMENTS(announce_id)
	ON DELETE CASCADE ON UPDATE CASCADE
) AUTO_INCREMENT=2000;


CREATE TABLE OFFERS_DETAILS (
    details_id INT,
    offer_status ENUM('pending', 'approved', 'finished', 'cancelled') NOT NULL,
    offer_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    approved_vehicle_id VARCHAR(25),
    approved_timestamp DATETIME,
    CONSTRAINT OFFERDETAILS FOREIGN KEY(details_id) REFERENCES OFFERS(offer_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE VOLUNTEER (
    volunteer_user VARCHAR(25),
    vehicle VARCHAR(25) UNIQUE,
    latitude_vehicle DECIMAL(10,8),
    longtitude_vehicle DECIMAL(10,8),
    PRIMARY KEY(volunteer_user),
	CONSTRAINT VOLUNTEERUSER FOREIGN KEY(volunteer_user) REFERENCES USERS(username)
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE VEHICLE_LOAD(
    vehicle_id VARCHAR(25) NOT NULL,
    item VARCHAR(25) NOT NULL,
    quantity INT NOT NULL,
    CONSTRAINT VEHICLE_LOAD FOREIGN KEY(vehicle_id) 
        REFERENCES VOLUNTEER(vehicle)
        ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ADMIN (
    admin_user VARCHAR(25) UNIQUE NOT NULL,
    latitude_vehicle DECIMAL(10, 8),
    longitude_vehicle DECIMAL(11, 8),
    PRIMARY KEY(admin_user),
	CONSTRAINT ADMINUSER FOREIGN KEY(admin_user) REFERENCES USERS(username)
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE OFFER_HISTORY (
    offer_history_id INT,
    history_status ENUM('pending', 'approved', 'finished', 'cancelled'),
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
	 CONSTRAINT OFFERHISTORY FOREIGN KEY(offer_history_id) REFERENCES OFFERS(offer_id)
	 ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE INQUIRY_HISTORY (
    inquiry_history_id INT,
    history_status ENUM('pending', 'approved', 'finished', 'cancelled'),
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
	 CONSTRAINT INQUIRYHISTORY FOREIGN KEY(inquiry_history_id) REFERENCES INQUIRY(inquiry_id)
	 ON DELETE CASCADE ON UPDATE CASCADE
);

insert into users values("admin","admin","administrator");

insert into admin values("admin", 38.264100945783525, 21.754283452141237);

insert into users values("maria","123","civilian");

insert into users values("mariak","mariak","civilian");
insert into users values("miltos","29092002","civilian");
insert into users values("sokratis","sokratis","civilian");
insert into users values("chryssa","1234","volunteer");
insert into users values("test","test","volunteer");
insert into users values("giorgos","giorgos","civilian");
insert into users values("evelina","evelina","civilian");

insert into civilian values("mariak","Maria Kouri","1234567890","38.90070000","22.42590000");
insert into civilian values("miltos","Miltiadis Mantes","6985932076","38.24663901","21.73457301");
insert into civilian values("sokratis","Sokratis Mantes","6985932089","38.47830004","22.59210002");
insert into civilian values("giorgos","Giorgos Karagiannis","0987654321","39.90070092","22.12590000");
insert into civilian values("evelina","Evangelia Kolagki","8796431009","37.90070092","22.12590000");

insert into volunteer(volunteer_user,vehicle) values("chryssa","CAR001");
insert into volunteer(volunteer_user,vehicle) values("test","CAR002");

insert into inquiry values("1","miltos","16","5");
insert into inquiry values("2","sokratis","18","2");
insert into inquiry values("3","giorgos","20","5");

insert into inquiry_details(details_id,inquiry_status) values("1","pending");
insert into inquiry_details(details_id,inquiry_status) values("2","pending");
insert into inquiry_details(details_id,inquiry_status) values("3","pending");

insert into offers values("2000","mariak","17","2");
insert into offers values("2001","evelina","26","2");

insert into offers_details(details_id,offer_status) values("2000","pending");
insert into offers_details(details_id,offer_status) values("2001","pending");

INSERT INTO volunteer(volunteer_user, vehicle, latitude_vehicle, longtitude_vehicle)
VALUES ('chryssa', 'CAR001', 37.983810, 23.727539),('test', 'CAR002', 35.339774, 25.144213);